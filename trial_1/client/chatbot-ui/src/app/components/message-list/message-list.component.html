@for (message of messages; track message) {
  <div class="message" [ngClass]="{
    'user-message': message.sender === 'user',
    'bot-message': message.sender === 'bot',
    'has-json': message.isJson
  }">
    @if (message.isLoading) {
      <mat-progress-spinner mode="indeterminate" [diameter]="30"></mat-progress-spinner>
    }
    @if (message.isJson) {
      <div class="json-container">
        <pre>{{ message.text }}</pre>
      </div>
    } @else {
      <markdown [data]="message.text"></markdown>
    }
    @if (message.isError) {
      <div class="error-container">
        <p class="error-text">{{ message.text }}</p>
        @if (message.retryable) {
          <button mat-stroked-button color="warn" (click)="onRetry(message)">Retry</button>
        }
      </div>
    }
    @if (message.isComponent && message.component === 'course-info') {
      <app-course-info [data]="message.componentData"></app-course-info>
    }
  </div>
}
